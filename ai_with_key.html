<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MCQ & Code Converter Tool with AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --dark-background: #1a1a1a;
            --text-color: #f0f0f0;
            --input-text-color: #ffffff;
            --rainbow-start: #ff0000;
            --rainbow-middle1: #ff7f00;
            --rainbow-middle2: #ffff00;
            --rainbow-middle3: #00ff00;
            --rainbow-middle4: #0000ff;
            --rainbow-end: #4b0082;
            --button-bg: linear-gradient(90deg, var(--rainbow-start), var(--rainbow-middle1), var(--rainbow-middle2), var(--rainbow-middle3), var(--rainbow-middle4), var(--rainbow-end));
            --button-hover-bg: linear-gradient(90deg, var(--rainbow-end), var(--rainbow-middle4), var(--rainbow-middle3), var(--rainbow-middle2), var(--rainbow-middle1), var(--rainbow-start));
            --card-background: #2a2a2a;
            --border-color: #444;
            --shadow-color: rgba(0, 0, 0, 0.5);
            --code-bg: #212121;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark-background);
            color: var(--text-color);
            line-height: 1.6;
        }

        .welcome-screen {
            background: radial-gradient(circle at top left, var(--rainbow-start) 0%, transparent 30%),
                        radial-gradient(circle at bottom right, var(--rainbow-end) 0%, transparent 30%),
                        var(--dark-background);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            animation: backgroundShift 15s ease-in-out infinite alternate;
        }

        @keyframes backgroundShift {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        .welcome-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            padding: 3rem;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px var(--shadow-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: fadeIn 1.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-title {
            font-size: 4.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-shadow: 0 5px 15px var(--shadow-color);
            background: var(--button-bg);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbowText 10s ease-in-out infinite;
        }

        @keyframes rainbowText {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .start-btn {
            background: var(--button-bg);
            color: var(--dark-background);
            border: none;
            padding: 1.2rem 4rem;
            font-size: 1.4rem;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.4s ease-in-out;
            box-shadow: 0 8px 20px var(--shadow-color);
            margin-top: 2rem;
            background-size: 200% auto;
        }

        .start-btn:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            background-position: right center;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            animation: float 10s ease-in-out infinite alternate;
        }

        .shape-1 {
            width: 350px;
            height: 350px;
            top: -150px;
            left: -150px;
            animation-delay: 0s;
        }

        .shape-2 {
            width: 250px;
            height: 250px;
            bottom: -100px;
            right: -100px;
            animation-delay: 2s;
        }

        .shape-3 {
            width: 180px;
            height: 180px;
            top: 50%;
            left: 10%;
            transform: translateY(-50%);
            animation-delay: 4s;
            opacity: 0.7;
        }

        .shape-4 {
            width: 220px;
            height: 220px;
            top: 10%;
            right: 15%;
            animation-delay: 6s;
            opacity: 0.6;
        }

        @keyframes float {
            0% { transform: translate(0, 0); }
            50% { transform: translate(20px, 20px); }
            100% { transform: translate(0, 0); }
        }

        .main-content {
            display: none;
            padding: 4rem 0;
        }

        .main-container {
            background: var(--card-background);
            border-radius: 15px;
            box-shadow: 0 10px 30px var(--shadow-color);
            padding: 2.5rem;
            margin-bottom: 2rem;
            position: relative;
            border: 1px solid var(--border-color);
        }

        .exit-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: var(--text-color);
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            padding: 0;
            z-index: 10;
        }

        .exit-btn:hover {
            color: var(--rainbow-start);
            transform: scale(1.2) rotate(5deg);
        }

        .section-title {
            color: var(--rainbow-middle3);
            font-weight: 600;
            margin-bottom: 1.5rem;
            position: relative;
            padding-bottom: 0.5rem;
            font-size: 2rem;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, var(--rainbow-start), var(--rainbow-middle4));
            border-radius: 3px;
        }

        .input-section {
            background: var(--code-bg);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .input-section-title {
            font-weight: 600;
            color: var(--rainbow-middle2);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            font-size: 1.2rem;
        }

        .input-section-title i {
            margin-right: 0.8rem;
            color: var(--rainbow-middle1);
            font-size: 1.5rem;
        }

        .form-control, .form-select {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--code-bg);
            color: var(--input-text-color);
            transition: all 0.3s ease;
        }

        .form-control:not(:placeholder-shown),
        textarea.form-control:not(:placeholder-shown) {
            color: var(--input-text-color);
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--rainbow-middle4);
            box-shadow: 0 0 0 0.25rem rgba(75, 0, 130, 0.4);
            background-color: #282828;
        }

        .form-control::placeholder {
            color: var(--input-text-color);
            opacity: 0.7;
        }
        .form-control::-webkit-input-placeholder {
            color: var(--input-text-color);
            opacity: 0.7;
        }
        .form-control::-moz-placeholder {
            color: var(--input-text-color);
            opacity: 0.7;
        }
        .form-control:-ms-input-placeholder {
            color: var(--input-text-color);
            opacity: 0.7;
        }
        .form-control::ms-input-placeholder {
            color: var(--input-text-color);
            opacity: 0.7;
        }

        textarea.form-control {
            min-height: 180px;
            font-family: 'Space Mono', monospace;
            font-size: 0.95rem;
            background-color: var(--code-bg);
            color: var(--input-text-color);
        }

        textarea.form-control::placeholder {
            color: var(--input-text-color);
            opacity: 0.7;
        }
        textarea.form-control::-webkit-input-placeholder {
            color: var(--input-text-color);
            opacity: 0.7;
        }
        textarea.form-control::-moz-placeholder {
            color: var(--input-text-color);
            opacity: 0.7;
        }
        textarea.form-control:-ms-input-placeholder {
            color: var(--input-text-color);
            opacity: 0.7;
        }
        textarea.form-control::ms-input-placeholder {
            color: var(--input-text-color);
            opacity: 0.7;
        }

        .btn-primary {
            background: var(--button-bg);
            border: none;
            padding: 0.8rem 2rem;
            font-weight: 700;
            border-radius: 8px;
            color: var(--dark-background);
            transition: all 0.3s ease-in-out;
            background-size: 200% auto;
        }

        .btn-primary:hover {
            background-position: right center;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-outline-secondary {
            border-radius: 8px;
            padding: 0.8rem 2rem;
            font-weight: 600;
            color: var(--text-color);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .btn-outline-secondary:hover {
            background-color: var(--border-color);
            color: var(--text-color);
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-group {
            gap: 1.5rem;
        }

        .example-box {
            background: #3a3a3a;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            border-left: 4px solid var(--rainbow-middle3);
            color: #c0c0c0;
            overflow-x: auto;
        }

        .question-box, .answer-box {
            background: var(--code-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            border-top: 5px solid transparent;
        }

        .question-box {
            border-image: linear-gradient(90deg, var(--rainbow-middle4), var(--rainbow-end));
            border-image-slice: 1;
        }

        .answer-box {
            border-image: linear-gradient(90deg, var(--rainbow-middle1), var(--rainbow-middle2));
            border-image-slice: 1;
        }

        .box-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-color);
            display: flex;
            align-items: center;
            font-size: 1.1rem;
        }

        .box-title i {
            margin-right: 0.6rem;
            font-size: 1.3rem;
            background: var(--button-bg);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% auto;
            animation: rainbowText 5s linear infinite;
        }

        .form-check-label {
            color: var(--text-color);
        }
        
        .form-check-input:checked {
            background-color: var(--rainbow-middle4);
            border-color: var(--rainbow-middle4);
        }

        .form-check-input:focus {
            box-shadow: 0 0 0 0.25rem rgba(75, 0, 130, 0.4);
        }

        /* Styles for MCQ Display and PDF Output */
        #mcq-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #333;
            border-radius: 5px;
            color: var(--text-color);
            display: none; /* Hidden by default, shown when MCQs are added/generated */
        }
        .mcq-item {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #555;
        }
        .mcq-item:last-child {
            border-bottom: none;
        }
        .mcq-item p {
            margin-bottom: 5px;
        }
        .mcq-item ol, .mcq-item ul {
            padding-left: 20px;
            margin-top: 5px;
        }
        .mcq-item li {
            margin-bottom: 3px;
        }
        .correct-answer {
            color: #00FF00; /* Green for correct answer in UI */
            font-weight: bold;
            margin-top: 5px;
        }

        /* Style for PDF content (hidden div) */
        .pdf-content-wrapper {
            display: none; /* Hidden by default, only for PDF generation */
            padding: 20px;
            font-family: 'Poppins', sans-serif;
            color: #000; /* Black text for PDF */
            background-color: #fff; /* White background for PDF */
        }
        .pdf-content-wrapper h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #000;
        }
        .pdf-content-wrapper .mcq-item {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ccc;
        }
        .pdf-content-wrapper .mcq-item:last-child {
            border-bottom: none;
        }
        .pdf-content-wrapper .mcq-item p {
            font-weight: bold;
            margin-bottom: 5px;
            color: #000;
        }
        .pdf-content-wrapper .mcq-item ol {
            list-style-type: lower-alpha;
            padding-left: 25px;
        }
        .pdf-content-wrapper .mcq-item li {
            margin-bottom: 2px;
            color: #000;
        }
        .pdf-content-wrapper .correct-answer {
            color: green; /* Green for correct answer in PDF */
            font-weight: bold;
            margin-top: 5px;
        }


        @media (max-width: 768px) {
            .welcome-title {
                font-size: 3rem;
            }
            
            .welcome-content {
                padding: 2rem;
            }
            
            .start-btn {
                padding: 1rem 3rem;
                font-size: 1.1rem;
            }

            .main-container {
                padding: 1.5rem;
            }

            .section-title {
                font-size: 1.6rem;
            }
        }
    </style>
</head>
<body>

<div class="welcome-screen" id="welcomeScreen">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
    <div class="shape shape-4"></div>
    <div class="welcome-content">
        <h1 class="welcome-title">MCQ & Code Converter</h1>
        <p class="lead" style="color: rgba(255, 255, 255, 0.9);">Effortlessly transform your MCQs to Excel and Code to PDF!</p>
        <button class="start-btn" id="startBtn">
            <i class="fas fa-play me-2"></i> Start Tool
        </button>
    </div>
</div>

<div class="main-content" id="mainContent">
    <div class="container">
        <div class="main-container">
            <button class="exit-btn" id="exitBtn" title="Exit to start page">
                <i class="fas fa-times-circle"></i>
            </button>
            
            <h1 class="text-center mb-4">MCQ & Code Converter Tool</h1>
            
            <form id="mainForm">
                <div class="mb-4">
                    <label for="inputType" class="form-label section-title">Choose Input Type</label>
                    <select class="form-select" id="inputType" required>
                        <option value="mcq">Multiple Choice Questions (MCQ)</option>
                        <option value="code">Code</option>
                    </select>
                </div>

                <div id="mcqSection">
                    <h3 class="section-title">MCQ Options</h3>
                    
                    <div class="input-section">
                        <div class="input-section-title">
                            <i class="fas fa-edit"></i> Input Method
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="manualEntry" name="mcqInputType" value="manual" checked>
                            <label class="form-check-label" for="manualEntry">Manual Entry</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="fileUpload" name="mcqInputType" value="file">
                            <label class="form-check-label" for="fileUpload">Upload File</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="aiMcqGenerate" name="mcqInputType" value="ai">
                            <label class="form-check-label" for="aiMcqGenerate">Generate with AI</label>
                        </div>
                    </div>
                    
                    <div id="manualEntrySection">
                        <div class="question-box">
                            <div class="box-title">
                                <i class="fas fa-question-circle"></i> Column Titles
                            </div>
                            <input type="text" class="form-control" id="columnTitles" placeholder="Enter column titles separated by commas (e.g., Question, Option A, Option B, Option C, Option D, Answer)" required>
                            <small class="text-muted">For multiple correct answers, separate with slashes (e.g., A/B or A/B/C)</small>
                        </div>
                        
                        <div class="answer-box">
                            <div class="box-title">
                                <i class="fas fa-list-ol"></i> Questions & Answers
                            </div>
                            <textarea class="form-control" id="mcqText" rows="8" placeholder="Enter each question on a new line, with columns separated by '|'. Example:&#10;What is 2+2? | 3 | 4 | 5 | 6 | B&#10;Capital of France? | London | Paris | Berlin | Madrid | B" required></textarea>
                        </div>
                    </div>
                    
                    <div id="fileUploadSection" style="display:none;">
                        <div class="input-section">
                            <div class="box-title">
                                <i class="fas fa-file-upload"></i> Upload MCQ File
                            </div>
                            <input type="file" class="form-control" id="mcqFile" accept=".txt">
                            <small class="text-muted">Upload a .txt file with each question on a new line, columns separated by '|'. First line should contain column titles.</small>
                            
                            <div class="mt-3">
                                <div class="box-title">
                                    <i class="fas fa-info-circle"></i> Example Format
                                </div>
                                <div class="example-box">
                                    Question,Option A,Option B,Option C,Option D,Answer<br>
                                    What is 2+2? | 3 | 4 | 5 | 6 | B<br>
                                    Capital of France? | London | Paris | Berlin | Madrid | B<br>
                                    Multiple answers? | Option1 | Option2 | Option3 | Option4 | A/B
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="aiMcqGenerateSection" style="display:none;">
    <div class="input-section">
        <div class="box-title">
            <i class="fas fa-robot"></i> AI MCQ Generation
        </div>
        <div class="mb-3">
            <label for="mcqTopic" class="form-label">Topic for MCQs:</label>
            <input type="text" class="form-control" id="mcqTopic" placeholder="e.g., Data Structures, World History, JavaScript Basics" required>
        </div>
        <div class="mb-3">
            <label for="numMcqQuestions" class="form-label">Number of Questions:</label>
            <input type="number" class="form-control" id="numMcqQuestions" min="1" max="50" value="5" required>
        </div>
        <div class="mb-3">
            <label for="mcqOutputColumnTitles" class="form-label">Output Column Titles (for Excel):</label>
            <input type="text" class="form-control" id="mcqOutputColumnTitles" 
                   placeholder="e.g., Question, Choice 1, Choice 2, Choice 3, Choice 4, Correct Answer" required>
            <small class="text-muted">Provide 6 comma-separated titles. The AI will generate standard options (A,B,C,D) which will map to your provided option titles.</small>
        </div>
        <button type="button" class="btn btn-primary" id="generateMcqBtn">
            <i class="fas fa-magic me-2"></i> Generate MCQs
        </button>
    </div>
</div>

                    <div id="mcq-container" class="mt-4">
                        <h3>Generated/Added MCQs:</h3>
                        <div id="mcq-list">
                            </div>
                    </div>

                </div>

                <div id="codeSection" style="display:none;">
                    <h3 class="section-title">Code Options</h3>
                    
                    <div class="input-section">
                        <div class="input-section-title">
                            <i class="fas fa-edit"></i> Input Method
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="codeManualEntry" name="codeInputType" value="manual" checked>
                            <label class="form-check-label" for="codeManualEntry">Manual Entry</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="codeFileUpload" name="codeInputType" value="file">
                            <label class="form-check-label" for="codeFileUpload">Upload File</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="aiCodeGenerate" name="codeInputType" value="ai">
                            <label class="form-check-label" for="aiCodeGenerate">Generate with AI</label>
                        </div>
                    </div>
                    
                    <div id="codeManualEntrySection">
                        <div class="question-box">
                            <div class="box-title">
                                <i class="fas fa-code"></i> Language Selection
                            </div>
                            <select class="form-select" id="codeLanguage">
                                <option value="cpp">C++ (Dev-C++)</option>
                                <option value="java">Java</option>
                                <option value="python">Python</option>
                                <option value="javascript">JavaScript</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="answer-box">
                            <div class="box-title">
                                <i class="fas fa-file-code"></i> Your Code
                            </div>
                            <textarea class="form-control" id="codeText" rows="15" placeholder="Paste your code here..."></textarea>
                        </div>
                    </div>
                    
                    <div id="codeFileUploadSection" style="display:none;">
                        <div class="question-box">
                            <div class="box-title">
                                <i class="fas fa-code"></i> Language Selection
                            </div>
                            <select class="form-select" id="codeLanguageUpload">
                                <option value="cpp">C++ (Dev-C++)</option>
                                <option value="java">Java</option>
                                <option value="python">Python</option>
                                <option value="javascript">JavaScript</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="answer-box">
                            <div class="box-title">
                                <i class="fas fa-file-upload"></i> Upload Code File
                            </div>
                            <input type="file" class="form-control" id="codeFile" accept=".cpp,.c,.h,.java,.py,.js,.txt">
                            <small class="text-muted">Supported formats: .cpp, .c, .h (for C++), .java, .py, .js, .txt</small>
                            
                            <div class="mt-3">
                                <div class="box-title">
                                    <i class="fas fa-info-circle"></i> Example C++ Code
                                </div>
                                <div class="example-box">
                                    #include &lt;iostream&gt;<br>
                                    using namespace std;<br><br>
                                    int main() {<br>
                                    &nbsp;&nbsp;int num;<br>
                                    &nbsp;&nbsp;cout &lt;&lt; "Enter a number: ";<br>
                                    &nbsp;&nbsp;cin &gt;&gt; num;<br><br>
                                    &nbsp;&nbsp;if(num % 2 == 0) {<br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;cout &lt;&lt; num &lt;&lt; " is even.";<br>
                                    &nbsp;&nbsp;} else {<br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;cout &lt;&lt; num &lt;&lt; " is odd.";<br>
                                    &nbsp;&nbsp;}<br><br>
                                    &nbsp;&nbsp;return 0;<br>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="aiCodeGenerateSection" style="display:none;">
                        <div class="input-section">
                            <div class="box-title">
                                <i class="fas fa-robot"></i> AI Code Generation
                            </div>
                            <div class="mb-3">
                                <label for="codeProblemDescription" class="form-label">Code Problem Description:</label>
                                <textarea class="form-control" id="codeProblemDescription" rows="5" placeholder="Describe the programming problem for which you need code, explanation, and test cases."></textarea>
                            </div>
                             <div class="mb-3">
                                <label for="aiCodeLanguage" class="form-label">Preferred Language:</label>
                                <select class="form-select" id="aiCodeLanguage">
                                    <option value="python">Python</option>
                                    <option value="cpp">C++</option>
                                    <option value="java">Java</option>
                                    <option value="javascript">JavaScript</option>
                                </select>
                            </div>
                            <button type="button" class="btn btn-primary" id="generateCodeBtn">
                                <i class="fas fa-brain me-2"></i> Generate Code
                            </button>
                        </div>
                        <div id="aiCodeOutput" style="display:none;">
                            <h4 class="section-title mt-4">Generated Code Output</h4>
                            <div class="answer-box">
                                <div class="box-title">
                                    <i class="fas fa-file-code"></i> Generated Code
                                    <button type="button" class="btn btn-sm btn-outline-secondary ms-auto" id="downloadAiCodePdfBtn">
                                        <i class="fas fa-file-pdf me-1"></i> Download Code PDF
                                    </button>
                                </div>
                                <pre id="generatedCodeDisplay" class="example-box" style="white-space: pre-wrap; word-wrap: break-word;"></pre>
                            </div>
                            <div class="answer-box">
                                <div class="box-title">
                                    <i class="fas fa-lightbulb"></i> Explanation
                                </div>
                                <p id="generatedExplanationDisplay" style="white-space: pre-wrap; word-wrap: break-word; color: var(--text-color);"></p>
                            </div>
                            <div class="answer-box">
                                <div class="box-title">
                                    <i class="fas fa-flask"></i> Test Cases
                                </div>
                                <pre id="generatedTestCasesDisplay" class="example-box" style="white-space: pre-wrap; word-wrap: break-word;"></pre>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="d-flex justify-content-center mt-4 btn-group">
                    <button type="button" class="btn btn-outline-secondary" id="backBtn">
                        <i class="fas fa-arrow-left me-2"></i> Back
                    </button>
                    <button type="submit" class="btn btn-primary" id="downloadFileBtn">
                        <i class="fas fa-download me-2"></i> Download File
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div id="pdf-content-wrapper" class="pdf-content-wrapper">
    <h2>Multiple Choice Questions</h2>
    <div id="mcq-pdf-content">
        </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>


<script>
    // Welcome screen elements
    const welcomeScreen = document.getElementById("welcomeScreen");
    const mainContent = document.getElementById("mainContent");
    const startBtn = document.getElementById("startBtn");
    const backBtn = document.getElementById("backBtn");
    const exitBtn = document.getElementById("exitBtn");

    // Main form elements
    const inputType = document.getElementById("inputType");
    const mcqSection = document.getElementById("mcqSection");
    const codeSection = document.getElementById("codeSection");
    const mainForm = document.getElementById("mainForm");
    const downloadFileBtn = document.getElementById("downloadFileBtn");

    // MCQ Input Sections
    const manualEntrySection = document.getElementById("manualEntrySection");
    const fileUploadSection = document.getElementById("fileUploadSection");
    const aiMcqGenerateSection = document.getElementById("aiMcqGenerateSection");
    const mcqFile = document.getElementById("mcqFile");
    const columnTitles = document.getElementById("columnTitles");
    const mcqText = document.getElementById("mcqText");
    const mcqTopic = document.getElementById("mcqTopic");
    const numMcqQuestions = document.getElementById("numMcqQuestions");
    const mcqOutputColumnTitles = document.getElementById("mcqOutputColumnTitles"); // New: for dynamic column titles
    const generateMcqBtn = document.getElementById("generateMcqBtn");
    const mcqList = document.getElementById("mcq-list"); // For displaying MCQs
    const mcqPdfContent = document.getElementById("mcq-pdf-content"); // For PDF generation content
    let currentMcqs = []; // Array to store MCQs for display and XLSX generation

    // Code Input Sections
    const codeManualEntrySection = document.getElementById("codeManualEntrySection");
    const codeFileUploadSection = document.getElementById("codeFileUploadSection");
    const aiCodeGenerateSection = document.getElementById("aiCodeGenerateSection");
    const codeFile = document.getElementById("codeFile");
    const codeText = document.getElementById("codeText");
    const codeLanguage = document.getElementById("codeLanguage");
    const codeLanguageUpload = document.getElementById("codeLanguageUpload");
    const codeProblemDescription = document.getElementById("codeProblemDescription");
    const aiCodeLanguage = document.getElementById("aiCodeLanguage");
    const generateCodeBtn = document.getElementById("generateCodeBtn");
    const aiCodeOutput = document.getElementById("aiCodeOutput");
    const generatedCodeDisplay = document.getElementById("generatedCodeDisplay");
    const generatedExplanationDisplay = document.getElementById("generatedExplanationDisplay");
    const generatedTestCasesDisplay = document.getElementById("generatedTestCasesDisplay");
    const downloadAiCodePdfBtn = document.getElementById("downloadAiCodePdfBtn");


    // Start button click handler
    startBtn.addEventListener("click", () => {
        welcomeScreen.style.display = "none";
        mainContent.style.display = "block";
    });

    // Back button click handler
    backBtn.addEventListener("click", () => {
        mainContent.style.display = "none";
        welcomeScreen.style.display = "flex";
    });

    // Exit button click handler
    exitBtn.addEventListener("click", () => {
        // Using a custom modal or message box instead of alert/confirm
        const userConfirmed = confirm("Are you sure you want to exit? Any unsaved work will be lost.");
        if (userConfirmed) {
            mainContent.style.display = "none";
            welcomeScreen.style.display = "flex";
            // Reset form
            mainForm.reset();
            // Reset any other state if needed (like input fields visibility)
            document.getElementById("manualEntry").checked = true;
            document.getElementById("codeManualEntry").checked = true;
            inputType.value = "mcq"; // Set default to MCQ
            inputType.dispatchEvent(new Event("change")); // Trigger change to show MCQ section
            aiCodeOutput.style.display = 'none'; // Hide AI code output
            mcqList.innerHTML = ''; // Clear displayed MCQs
            document.getElementById('mcq-container').style.display = 'none'; // Hide MCQ display container
            currentMcqs = []; // Clear stored MCQs
        }
    });

    function setMcqInputRequirements(inputTypeRadio) {
    columnTitles.required = false;
    mcqText.required = false;
    mcqFile.required = false;
    mcqTopic.required = false;
    numMcqQuestions.required = false;
    mcqOutputColumnTitles.required = false;
    mcqList.innerHTML = ''; // Clear displayed MCQs
    document.getElementById('mcq-container').style.display = 'none'; // Hide MCQ display container
    currentMcqs = []; // Clear stored MCQs

    if (inputTypeRadio === 'manual') {
        columnTitles.required = true;
        mcqText.required = true;
        downloadFileBtn.style.display = 'block';
    } else if (inputTypeRadio === 'file') {
        mcqFile.required = true;
        downloadFileBtn.style.display = 'block';
    } else if (inputTypeRadio === 'ai') {
        mcqTopic.required = true;
        numMcqQuestions.required = true;
        mcqOutputColumnTitles.required = true;
        downloadFileBtn.style.display = 'block';
    }
}

    // Toggle between MCQ input methods (Manual, File, AI)
    document.querySelectorAll('input[name="mcqInputType"]').forEach(radio => {
        radio.addEventListener('change', function() {
            manualEntrySection.style.display = 'none';
            fileUploadSection.style.display = 'none';
            aiMcqGenerateSection.style.display = 'none';
            
            if(this.value === 'manual') {
                manualEntrySection.style.display = 'block';
            } else if (this.value === 'file') {
                fileUploadSection.style.display = 'block';
            } else if (this.value === 'ai') {
                aiMcqGenerateSection.style.display = 'block';
            }
            setMcqInputRequirements(this.value);
        });
    });

    // Function to set required attributes for Code inputs
    function setCodeInputRequirements(inputTypeRadio) {
        codeText.required = false;
        codeFile.required = false;
        codeProblemDescription.required = false;
        aiCodeOutput.style.display = 'none'; // Hide AI code output when input method changes
        
        if (inputTypeRadio === 'manual') {
            codeText.required = true;
            downloadFileBtn.style.display = 'block';
        } else if (inputTypeRadio === 'file') {
            codeFile.required = true;
            downloadFileBtn.style.display = 'block';
        } else if (inputTypeRadio === 'ai') {
            codeProblemDescription.required = true;
            downloadFileBtn.style.display = 'none'; // Hide download button for AI generation
        }
    }

    // Toggle between Code input methods (Manual, File, AI)
    document.querySelectorAll('input[name="codeInputType"]').forEach(radio => {
        radio.addEventListener('change', function() {
            codeManualEntrySection.style.display = 'none';
            codeFileUploadSection.style.display = 'none';
            aiCodeGenerateSection.style.display = 'none';

            if(this.value === 'manual') {
                codeManualEntrySection.style.display = 'block';
            } else if (this.value === 'file') {
                codeFileUploadSection.style.display = 'block';
            } else if (this.value === 'ai') {
                aiCodeGenerateSection.style.display = 'block';
            }
            setCodeInputRequirements(this.value);
        });
    });

    // Toggle between MCQ and Code sections
    inputType.addEventListener("change", () => {
        if (inputType.value === "mcq") {
            mcqSection.style.display = "block";
            codeSection.style.display = "none";
            // Trigger change event for MCQ input type to set required attributes and visibility
            document.querySelector('input[name="mcqInputType"]:checked').dispatchEvent(new Event('change'));
        } else {
            mcqSection.style.display = "none";
            codeSection.style.display = "block";
            // Trigger change event for code input type to set required attributes and visibility
            document.querySelector('input[name="codeInputType"]:checked').dispatchEvent(new Event('change'));
        }
    });

    // Helper function to read file as text
    function readFileAsText(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = event => resolve(event.target.result);
            reader.onerror = error => reject(error);
            reader.readAsText(file);
        });
    }

    /**
     * Renders the currentMcqs array into the mcq-list div.
     */
    function renderMcqList() {
        mcqList.innerHTML = '';
        if (currentMcqs.length > 0) {
            document.getElementById('mcq-container').style.display = 'block';
        } else {
            document.getElementById('mcq-container').style.display = 'none';
            return;
        }

        currentMcqs.forEach((mcq, index) => {
            const mcqItem = document.createElement('div');
            mcqItem.classList.add('mcq-item');
            mcqItem.innerHTML = `
                <p><strong>Question ${index + 1}:</strong> ${mcq.question}</p>
                <ol>
                    <li>A) ${mcq.optionA || ''}</li>
                    <li>B) ${mcq.optionB || ''}</li>
                    <li>C) ${mcq.optionC || ''}</li>
                    <li>D) ${mcq.optionD || ''}</li>
                </ol>
                <p class="correct-answer">Correct Answer: ${mcq.answer || 'N/A'}</p>
            `;
            mcqList.appendChild(mcqItem);
        });
    }

    // Removed populatePdfContentWrapper and generateMcqPdfBtn event listener as per user request.


    // *** AI Integration Functions ***

    /**
     * Simulates generating MCQs based on a topic and number of questions.
     * In a real application, this would be an API call to an LLM.
     * @param {string} topic - The topic for MCQ generation.
     * @param {number} numQuestions - The number of MCQs to generate.
     * @returns {Promise<Array<Object>>} A promise that resolves with an array of MCQ objects.
     */
   async function generateMcqsWithAI(topic, numQuestions, columnTitles) {
    // Simulate API call to Gemini-2.0-flash for structured response
    let chatHistory = [];
    const prompt = `Generate ${numQuestions} multiple-choice questions about "${topic}". 
Each question should have 4 options (A, B, C, D) and one correct answer. 
Format the output as a JSON array where each object has:
- 'question' (the question text)
- 'optionA', 'optionB', 'optionC', 'optionD' (the answer choices)
- 'answer' (the correct option letter, e.g., 'A', 'B', 'C', or 'D')`;
    
    chatHistory.push({ role: "user", parts: [{ text: prompt }] });

    const payload = {
        contents: chatHistory,
        generationConfig: {
            responseMimeType: "application/json",
            responseSchema: {
                type: "ARRAY",
                items: {
                    type: "OBJECT",
                    properties: {
                        "question": { "type": "STRING" },
                        "optionA": { "type": "STRING" },
                        "optionB": { "type": "STRING" },
                        "optionC": { "type": "STRING" },
                        "optionD": { "type": "STRING" },
                        "answer": { "type": "STRING" }
                    },
                    "propertyOrdering": ["question", "optionA", "optionB", "optionC", "optionD", "answer"]
                }
            }
        }
    };

    const apiKey = "AIzaSyBYBqY5KecX_Txz5pARZZUTnBOppkA9BL8"; // Inserted Gemini API key
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const result = await response.json();

        if (result.candidates && result.candidates.length > 0 &&
            result.candidates[0].content && result.candidates[0].content.parts &&
            result.candidates[0].content.parts.length > 0) {
            const jsonString = result.candidates[0].content.parts[0].text;
            // LLM might return markdown code block, so parse it
            const cleanedJsonString = jsonString.replace(/```json\n|\n```/g, '').trim();
            const parsedJson = JSON.parse(cleanedJsonString);
            return parsedJson;
        } else {
            console.error("AI response structure unexpected:", result);
            return [];
        }
    } catch (error) {
        console.error("Error calling Gemini API for MCQs:", error);
        return [];
    }
}

    /**
     * Simulates generating code, explanation, and test cases using an AI agent.
     * In a real application, this would be an API call to an LLM.
     * @param {string} problemDescription - The description of the coding problem.
     * @param {string} language - The preferred programming language.
     * @returns {Promise<Object>} A promise that resolves with an object containing code, explanation, and testCases.
     */
    async function generateCodeWithAI(problemDescription, language) {
    let chatHistory = [];
    const prompt = `Generate a complete code solution in ${language} for the following problem: "${problemDescription}".
Also, provide a detailed explanation of the code and 2-3 relevant test cases with expected outputs.
Format the output as follows:

---CODE---
[Your ${language} code here]
---EXPLANATION---
[Your explanation here]
---TESTCASES---
[Test Case 1]
Input: ...
Output: ...

[Test Case 2]
Input: ...
Output: ...
`;
    chatHistory.push({ role: "user", parts: [{ text: prompt }] });

    const payload = { contents: chatHistory };
    const apiKey = "AIzaSyBYBqY5KecX_Txz5pARZZUTnBOppkA9BL8";
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const result = await response.json();

        if (result?.candidates?.[0]?.content?.parts?.[0]?.text) {
            const fullText = result.candidates[0].content.parts[0].text;

            const codeMatch = fullText.match(/---\s*CODE\s*---[\r\n]+([\s\S]*?)---\s*EXPLANATION\s*---/i);
            const explanationMatch = fullText.match(/---\s*EXPLANATION\s*---[\r\n]+([\s\S]*?)---\s*TESTCASES\s*---/i);
            const testCasesMatch = fullText.match(/---\s*TESTCASES\s*---[\r\n]+([\s\S]*)/i);

            const code = codeMatch ? codeMatch[1].trim() : "Could not extract code. Full response:\n" + fullText;
            const explanation = explanationMatch ? explanationMatch[1].trim() : "Could not extract explanation.";
            const testCases = testCasesMatch ? testCasesMatch[1].trim() : "Could not extract test cases.";

            return { code, explanation, testCases };
        } else {
            console.error("AI response structure unexpected:", result);
            return { code: "Error generating code.", explanation: "", testCases: "" };
        }
    } catch (error) {
        console.error("Error calling Gemini API for code:", error);
        return { code: "Error generating code.", explanation: "", testCases: "" };
    }
}

    // Event listener for AI MCQ Generation button
  generateMcqBtn.addEventListener("click", async () => {
    const topic = mcqTopic.value.trim();
    const num = parseInt(numMcqQuestions.value, 10);
    const outputTitlesString = mcqOutputColumnTitles.value.trim();

    if (!topic) {
        alert("Please enter a topic for MCQ generation.");
        return;
    }
    if (isNaN(num) || num <= 0 || num > 50) {
        alert("Please enter a valid number of questions (1-50).");
        return;
    }
    if (!outputTitlesString) {
        alert("Please enter output column titles for the Excel file.");
        return;
    }
    
    const outputColumns = outputTitlesString.split(",").map(t => t.trim());
    if (outputColumns.length !== 6) {
        alert("Please provide exactly 6 comma-separated column titles (e.g., Question, Option 1, Option 2, Option 3, Option 4, Answer).");
        return;
    }

    try {
        // Show a loading indicator
        generateMcqBtn.textContent = 'Generating...';
        generateMcqBtn.disabled = true;
        mcqList.innerHTML = ''; // Clear previous MCQs
        document.getElementById('mcq-container').style.display = 'none'; // Hide container during generation
        currentMcqs = []; // Clear stored MCQs

        const generatedMcqs = await generateMcqsWithAI(topic, num, outputColumns);

        if (generatedMcqs.length === 0) {
            alert("No MCQs were generated. Please try again with a different topic or number of questions.");
            return;
        }

        currentMcqs = generatedMcqs; // Store generated MCQs
        renderMcqList(); // Display them

        // Prepare data for XLSX using dynamic output columns
        let sheetData = [outputColumns]; // Use user-defined columns as header

        generatedMcqs.forEach(mcq => {
            sheetData.push([
                mcq.question || '',
                mcq.optionA || '',
                mcq.optionB || '',
                mcq.optionC || '',
                mcq.optionD || '',
                (Array.isArray(mcq.answer) ? mcq.answer.join('/') : mcq.answer || '')
            ]);
        });

        // Generate workbook and worksheet
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(sheetData);

        // Auto-size columns based on content
        const colWidths = [];
        sheetData.forEach(row => {
            row.forEach((cell, colIndex) => {
                const width = String(cell).length;
                if (!colWidths[colIndex] || width > colWidths[colIndex]) {
                    colWidths[colIndex] = width;
                }
            });
        });

        ws['!cols'] = colWidths.map(width => ({ 
            wch: Math.min(Math.max(width + 2, 10), 50)
        }));

        XLSX.utils.book_append_sheet(wb, ws, "AI_Generated_MCQs");
        XLSX.writeFile(wb, `AI_MCQs_${topic.replace(/\s/g, '_')}.xlsx`);
        alert("AI Generated MCQ file downloaded successfully!");

    } catch (error) {
        console.error("Error generating MCQs with AI:", error);
        alert("Failed to generate MCQs with AI. Please check the console for details.");
    } finally {
        generateMcqBtn.textContent = 'Generate MCQs';
        generateMcqBtn.disabled = false;
    }
});

    // Event listener for AI Code Generation button
    generateCodeBtn.addEventListener("click", async () => {
        const problemDescription = codeProblemDescription.value.trim();
        const language = aiCodeLanguage.value;

        if (!problemDescription) {
            alert("Please enter a problem description for code generation.");
            return;
        }

        try {
            // Show a loading indicator
            generateCodeBtn.textContent = 'Generating...';
            generateCodeBtn.disabled = true;
            aiCodeOutput.style.display = 'none'; // Hide previous output while generating

            const result = await generateCodeWithAI(problemDescription, language);

            if (!result || !result.code) {
                alert("No code was generated. Please try again.");
                return;
            }

            // Display results
            generatedCodeDisplay.textContent = result.code;
            generatedExplanationDisplay.textContent = result.explanation || 'No explanation provided.';
            generatedTestCasesDisplay.textContent = result.testCases || 'No test cases provided.';
            aiCodeOutput.style.display = 'block';

            alert("AI Generated code, explanation, and test cases are displayed. You can download the code as PDF.");

        } catch (error) {
            console.error("Error generating code with AI:", error);
            alert("Failed to generate code with AI. Please check the console for details.");
        } finally {
            generateCodeBtn.textContent = 'Generate Code';
            generateCodeBtn.disabled = false;
        }
    });

    // Event listener for downloading AI generated code as PDF
    downloadAiCodePdfBtn.addEventListener('click', () => {
        const codeToDownload = generatedCodeDisplay.textContent;
        const language = aiCodeLanguage.value; // Use the language selected for AI generation

        if (!codeToDownload) {
            alert("No code to download. Please generate code first.");
            return;
        }

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({
            unit: "pt",
            format: "a4"
        });

        const margin = 40;
        const maxLineWidth = doc.internal.pageSize.getWidth() - 2 * margin;
        const fontSize = 10;
        const lineHeight = 1.2;

        doc.setFont("Space Mono", "normal");
        doc.setFontSize(fontSize);
        doc.setTextColor("#000000"); // Black text for better PDF readability

        // Add language info at the top
        const languageText = language === "cpp" ? "C++ (Dev-C++)" : 
                             language === "java" ? "Java" :
                             language === "python" ? "Python" :
                             language === "javascript" ? "JavaScript" : "Other";
        
        doc.setFontSize(12);
        doc.text(`Language: ${languageText}`, margin, margin - 15);
        doc.setFontSize(fontSize);

        let y = margin;
        const lines = codeToDownload.split('\n');

        lines.forEach(line => {
            const wrappedLines = doc.splitTextToSize(line, maxLineWidth);
            wrappedLines.forEach(wrappedLine => {
                const keywords = ['int', 'void', 'cout', 'cin', 'if', 'else', 'for', 'while', 'class', 'public', 'private', 'static', 'return', 'import', 'function', 'const', 'let', 'var', 'def', 'print', 'System.out.println', 'console.log', '#include', 'using', 'namespace', 'this', 'new', 'true', 'false', 'null', 'undefined', 'async', 'await'];
                
                let xOffset = margin;
                // Split the line by keywords to apply different colors
                const parts = wrappedLine.split(/(\b(?:int|void|cout|cin|if|else|for|while|class|public|private|static|return|import|function|const|let|var|def|print|System\.out\.println|console\.log|#include|using|namespace|this|new|true|false|null|undefined|async|await)\b)/g);

                parts.forEach(part => {
                    if (keywords.includes(part)) {
                        doc.setTextColor("#0000FF"); // Blue for keywords
                    } else {
                        doc.setTextColor("#000000"); // Black for other text
                    }
                    doc.text(part, xOffset, y);
                    xOffset += doc.getStringUnitWidth(part) * fontSize;
                });
                
                y += fontSize * lineHeight;
                if (y > doc.internal.pageSize.getHeight() - margin) {
                    doc.addPage();
                    y = margin;
                    doc.setFont("Space Mono", "normal");
                    doc.setFontSize(fontSize);
                    doc.setTextColor("#000000");
                }
            });
        });

        let filename = "code_output";
        if(language === "cpp") filename = "program.cpp";
        else if(language === "java") filename = "Program.java";
        else if(language === "python") filename = "script.py";
        else if(language === "javascript") filename = "script.js";
        
        doc.save(`${filename}.pdf`);
        alert("Code PDF downloaded successfully!");
    });


    // Original form submission for manual/file inputs
    mainForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        if(inputType.value === "mcq") {
            const mcqInputType = document.querySelector('input[name="mcqInputType"]:checked').value;
            // Handle AI generation separately via its own button
            if (mcqInputType === 'ai') {
                const topic = mcqTopic.value.trim();
                const num = parseInt(numMcqQuestions.value, 10);
                const outputTitlesString = mcqOutputColumnTitles.value.trim();

                if (!topic || isNaN(num) || num <= 0 || num > 50 || !outputTitlesString) {
                    alert("Please fill all required fields for AI MCQ generation.");
                    return;
                }
                // The generateMcqBtn listener already handles the AI generation and XLSX download
                // so we just return here to prevent double submission or incorrect handling.
                return; 
            }

            let titles, mcqRaw;
            
            if(mcqInputType === 'manual') {
                titles = columnTitles.value.trim();
                mcqRaw = mcqText.value.trim();
            } else if (mcqInputType === 'file') {
                if(!mcqFile.files.length) {
                    alert("Please select a file to upload.");
                    return;
                }
                
                try {
                    const fileContent = await readFileAsText(mcqFile.files[0]);
                    const lines = fileContent.split('\n');
                    if (lines.length === 0) {
                        alert("The uploaded file is empty.");
                        return;
                    }
                    titles = lines[0].trim();
                    mcqRaw = lines.slice(1).join('\n').trim();
                    if (!titles) {
                        alert("The first line (column titles) in the file is empty.");
                        return;
                    }
                } catch(error) {
                    alert("Error reading file: " + error.message);
                    return;
                }
            }

            if(!titles || !mcqRaw) {
                alert("Please provide MCQ data.");
                return;
            }

            const columns = titles.split(",").map(t => t.trim());
            const rows = mcqRaw.split("\n").map(line => line.split("|").map(cell => cell.trim()));

            // Populate currentMcqs for display
            currentMcqs = rows.map(row => ({
                question: row[0] || '',
                optionA: row[1] || '',
                optionB: row[2] || '',
                optionC: row[3] || '',
                optionD: row[4] || '',
                answer: row[5] || ''
            }));
            renderMcqList(); // Display the MCQs

            let sheetData = [columns];
            rows.forEach(row => {
                while(row.length < columns.length) row.push("");
                sheetData.push(row.slice(0, columns.length));
            });

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(sheetData);

            const colWidths = [];
            sheetData.forEach(row => {
                row.forEach((cell, colIndex) => {
                    const width = String(cell).length;
                    if (!colWidths[colIndex] || width > colWidths[colIndex]) {
                        colWidths[colIndex] = width;
                    }
                });
            });

            ws['!cols'] = colWidths.map(width => ({ 
                wch: Math.min(Math.max(width + 2, 10), 50)
            }));

            XLSX.utils.book_append_sheet(wb, ws, "MCQs");
            XLSX.writeFile(wb, "mcq_output.xlsx");
            alert("MCQ file downloaded successfully!");

        } else if(inputType.value === "code") {
            const codeInputType = document.querySelector('input[name="codeInputType"]:checked').value;
            if (codeInputType === 'ai') {
                // If AI generation is selected, the specific button handler will take care of it.
                // This submit button is not meant for AI generation in this configuration.
                return; 
            }

            let codeContent, language;
            
            if(codeInputType === 'manual') {
                codeContent = codeText.value.trim();
                language = codeLanguage.value;
            } else if (codeInputType === 'file') {
                if(!codeFile.files.length) {
                    alert("Please select a file to upload.");
                    return;
                }
                
                try {
                    codeContent = await readFileAsText(codeFile.files[0]);
                    language = codeLanguageUpload.value;
                } catch(error) {
                    alert("Error reading file: " + error.message);
                    return;
                }
            }
            
            if(!codeContent) {
                alert("Please enter or upload the code.");
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                unit: "pt",
                format: "a4"
            });

            const margin = 40;
            const maxLineWidth = doc.internal.pageSize.getWidth() - 2 * margin;
            const fontSize = 10;
            const lineHeight = 1.2;

            doc.setFont("Space Mono", "normal");
            doc.setFontSize(fontSize);
            doc.setTextColor("#000000"); // Changed from light grey to black for better contrast

            const languageText = language === "cpp" ? "C++ (Dev-C++)" : 
                                 language === "java" ? "Java" :
                                 language === "python" ? "Python" :
                                 language === "javascript" ? "JavaScript" : "Other";
            
            doc.setFontSize(12);
            doc.text(`Language: ${languageText}`, margin, margin - 15);
            doc.setFontSize(fontSize);

            let y = margin;
            const lines = codeContent.split('\n');

            lines.forEach(line => {
                const wrappedLines = doc.splitTextToSize(line, maxLineWidth);
                wrappedLines.forEach(wrappedLine => {
                    const keywords = ['int', 'void', 'cout', 'cin', 'if', 'else', 'for', 'while', 'class', 'public', 'private', 'static', 'return', 'import', 'function', 'const', 'let', 'var', 'def', 'print', 'System.out.println', 'console.log', '#include', 'using', 'namespace', 'this', 'new', 'true', 'false', 'null', 'undefined', 'async', 'await'];
                    
                    let xOffset = margin;
                    const parts = wrappedLine.split(/(\b(?:int|void|cout|cin|if|else|for|while|class|public|private|static|return|import|function|const|let|var|def|print|System\.out\.println|console\.log|#include|using|namespace|this|new|true|false|null|undefined|async|await)\b)/g);

                    parts.forEach(part => {
                        if (keywords.includes(part)) {
                            doc.setTextColor("#0000FF"); // Blue for keywords
                        } else {
                            doc.setTextColor("#000000"); // Black for other text
                        }
                        doc.text(part, xOffset, y);
                        xOffset += doc.getStringUnitWidth(part) * fontSize;
                    });

                    y += fontSize * lineHeight;
                    if (y > doc.internal.pageSize.getHeight() - margin) {
                        doc.addPage();
                        y = margin;
                        doc.setFont("Space Mono", "normal");
                        doc.setFontSize(fontSize);
                        doc.setTextColor("#000000");
                    }
                });
            });
            
            let filename = "code_output";
            if(language === "cpp") filename = "program.cpp";
            else if(language === "java") filename = "Program.java";
            else if(language === "python") filename = "script.py";
            else if(language === "javascript") filename = "script.js";
            
            doc.save(`${filename}.pdf`);
            alert("Code PDF downloaded successfully!");
        }
    });

    // Trigger change event on page load to set correct section visible
    inputType.dispatchEvent(new Event("change"));
</script>

</body>
</html>
